<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-X5WQCB3JYT');
  </script>
  <!-- FIX: ブラウザのスクロール位置復元を無効化（lang切替リロード時にトップから開始） -->
  <script>if('scrollRestoration' in history) history.scrollRestoration='manual';</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>欠損駆動思考 - Kesson Space</title>
  <link rel="icon" href="./favicon.ico">

  <!-- Bootstrap CSS (for devlog offcanvas + lightbox) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="./src/styles/main.css">

  <!-- PERF: CDN TLS接続を先行確立 -->
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <!-- FIX: Google Fonts — Noto Serif JP (高品質明朝体) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400&display=swap" rel="stylesheet">

  <!-- DISABLED: modulepreload — import mapとの競合問題で一時無効化 (Issue #4) -->

  
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/",
        "marked": "https://cdn.jsdelivr.net/npm/marked@15.0.7/lib/marked.esm.js"
      }
    }
  </script>

  <!-- PERF: module scripts are deferred by default — placing after import map
       lets the browser start fetching the module graph earlier than end-of-body,
       without reintroducing the modulepreload/import-map ordering conflict (Issue #4) -->
  <script type="module" src="./src/main.js"></script>
</head>
<body>
  <div id="canvas-container" aria-hidden="true"></div>

  <!-- 左上クレジット -->
  <div id="credit">
    <div class="credit-line" id="credit-collab">AIとの協働で探索中</div>
    <div class="credit-signature" id="credit-signature">Project Designer — pjdhiro</div>
  </div>
  
  <div id="overlay">
    <div id="taglines"></div>

    <a href="https://uminomae.github.io/pjdhiro/thinking-kesson/" target="_blank" rel="noopener">
      <h1 id="title-h1">欠損駆動思考</h1>
    </a>
    <p class="subtitle" id="title-sub">Kesson Space</p>
  </div>

  <!-- 右上: 操作ガイド（lang-toggle の下に配置） -->
  <div id="control-guide">
    <!-- デスクトップ版 -->
    <div class="guide-row guide-desktop">
      <span class="guide-key" data-ja="ドラッグ" data-en="drag">drag</span>
      <span class="guide-sep">—</span>
      <span class="guide-action" data-ja="回転" data-en="rotate">rotate</span>
    </div>
    <div class="guide-row guide-desktop">
      <span class="guide-key">Ctrl + wheel</span>
      <span class="guide-sep">—</span>
      <span class="guide-action" data-ja="ズーム" data-en="zoom">zoom</span>
    </div>
    <div class="guide-row guide-desktop">
      <span class="guide-key" data-ja="スクロール" data-en="scroll">scroll</span>
      <span class="guide-sep">—</span>
      <span class="guide-action" data-ja="潜水" data-en="dive">dive</span>
    </div>
    <!-- モバイル版 -->
    <div class="guide-row guide-touch">
      <span class="guide-key" data-ja="横スワイプ" data-en="swipe">swipe</span>
      <span class="guide-sep">—</span>
      <span class="guide-action" data-ja="回転" data-en="rotate">rotate</span>
    </div>
    <div class="guide-row guide-touch">
      <span class="guide-key" data-ja="ピンチ" data-en="pinch">pinch</span>
      <span class="guide-sep">—</span>
      <span class="guide-action" data-ja="ズーム" data-en="zoom">zoom</span>
    </div>
    <div class="guide-row guide-touch">
      <span class="guide-key" data-ja="縦スクロール" data-en="scroll">scroll</span>
      <span class="guide-sep">—</span>
      <span class="guide-action" data-ja="潜水" data-en="dive">dive</span>
    </div>
  </div>

  <!-- スクロール案内（下部） -->
  <div id="scroll-hint">
    <span>scroll</span>
    <div class="arrow">▾</div>
  </div>

  <!-- スクロール案内（上部） -->
  <div id="scroll-hint-top">
    <div class="arrow">▴</div>
    <span>scroll</span>
  </div>

  <!-- 潜水スペーサー（カメラ下降のスクロール余白） -->
  <div id="hero-spacer"></div>
  <!-- Articles出現タイミング調整スペーサー -->
  <div id="articles-spacer"></div>

  <!-- Articles Section -->
  <!-- CHANGED(2026-02-16): inline style → CSS class (T-018) -->
  <section id="articles-section">
    <div class="section-content-wrap">
      <div class="container">
        <h2 class="section-heading">ARTICLES</h2>
        <div id="articles-error" class="d-none"></div>
        <div id="articles-grid" class="row g-3"></div>
      </div>
    </div>
  </section>

  <!-- Devlog Gallery Section（テキストログ削除、すぐギャラリー） -->
  <section id="devlog-gallery-section">
    <!-- CHANGED(2026-02-16): inline style → CSS class (T-018) -->
    <div class="section-content-wrap">
      <div class="container">
        <h2 class="section-heading">DEVLOG</h2>
      </div>
    </div>
    <div id="devlog-gallery-container"></div>
    <div id="devlog-gallery-header">
      <h2>TRACES</h2>
    </div>
  </section>

  <!-- Bootstrap Offcanvas（右からスライドイン） -->
  <div class="offcanvas offcanvas-end offcanvas-kesson"
       tabindex="-1"
       id="devlogOffcanvas"
       data-bs-backdrop="true">
    <div class="offcanvas-header border-bottom border-secondary">
      <button type="button" class="btn btn-link text-light p-0 me-2 d-none"
              id="offcanvas-back-btn" aria-label="一覧に戻る">
        ←
      </button>
      <div>
        <h5 class="text-light mb-0 offcanvas-title-spaced">DEVLOG</h5>
        <small class="text-muted" id="offcanvas-session-count"></small>
      </div>
      <button type="button" class="btn-close btn-close-white"
              data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-0">
      <!-- 一覧ビュー -->
      <div id="offcanvas-list-view">
        <div id="offcanvas-gallery"></div>
      </div>
      <!-- 詳細ビュー（初期非表示） -->
      <div id="offcanvas-detail-view" class="d-none">
        <div class="p-3">
          <div id="detail-cover" class="mb-3">
            <img id="detail-cover-img" class="img-fluid rounded cursor-pointer" alt="Session cover">
          </div>
          <h5 id="detail-title" class="text-light mb-1"></h5>
          <small id="detail-date" class="text-muted d-block mb-3"></small>
          <div id="detail-content" class="session-content"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Articles Offcanvas -->
  <div class="offcanvas offcanvas-end offcanvas-kesson"
       tabindex="-1"
       id="articlesOffcanvas"
       data-bs-backdrop="true">
    <div class="offcanvas-header border-bottom border-secondary">
      <div>
        <h5 class="text-light mb-0 offcanvas-title-spaced">ARTICLES</h5>
        <small class="text-muted" id="offcanvas-articles-count"></small>
      </div>
      <button type="button" class="btn-close btn-close-white"
              data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-3">
      <div id="articles-filter-group" class="articles-filter-group mb-3" role="group" aria-label="Filter articles by type">
        <button type="button" class="articles-filter-btn is-active" data-type="all" aria-pressed="true">All</button>
        <button type="button" class="articles-filter-btn" data-type="page" aria-pressed="false">Page</button>
        <button type="button" class="articles-filter-btn" data-type="post" aria-pressed="false">Post</button>
      </div>
      <div id="offcanvas-articles-grid" class="row g-3"></div>
    </div>
  </div>

  <!-- Image Lightbox Modal -->
  <div class="modal fade" id="imageLightboxModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-xl">
      <div class="modal-content bg-transparent border-0">
        <div class="modal-body p-0 text-center">
          <img id="lightbox-image" class="img-fluid" alt="Enlarged cover">
        </div>
      </div>
    </div>
  </div>

  <!-- CHANGED: aria-label 追加 -->
  <button id="surface-btn" aria-label="ページ上部に戻る">↑ surface</button>

  <script type="module" src="./src/pages/e2e-auto-run.js"></script>
  <script type="module" src="./src/pages/articles-section.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
